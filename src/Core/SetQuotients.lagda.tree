\title{Set Quotients}
\taxon{Module}
\author{markwilliams}
\date{2025-12-09}
\import{stt-macros}

%```agda
\agda{
{-# OPTIONS --lossy-unification #-}

module Core.SetQuotients where

open import Foundations.Prelude
open import ufAxioms
open import Core.Coequalisers
open import Modalities.Instances.Truncation
}
%```


\subtree[stt-00D2]{
\title{Set Quotients}
\taxon{Definition}

\p{Given a type #{A} and a relation #{R : A \to A \to \UU} we can
   define the set quotient of #{A} by #{R} as a [set](stt-006T) #{A / R}
   with a map #{\pi : A \to A / R} universally turning related elements
   #{a, b : A} such that #{R(a,b)} into equal elements #{\pi(a) = \pi(b)}
   amongst sets.}

\p{We define this as the set truncation of the coequaliser of
   the two projections #{(a, b : A) \times R(a,b) \rightrightarrows A}.}

%```agda
\agda{
private
  tot : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} (R : A â†’ A â†’ Type ğ“¥) â†’ Type (ğ“¤ âŠ” ğ“¥)
  tot {A = A} R = Î£ A (Î» x â†’ Î£ A (R x))

  left : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {R : A â†’ A â†’ Type ğ“¥} â†’ tot R â†’ A
  left (x , _ , _) = x

  right : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {R : A â†’ A â†’ Type ğ“¥} â†’ tot R â†’ A
  right (_ , x , _) = x


_/_ : âˆ€ {ğ“¤ ğ“¥} (A : Type ğ“¤) (R : A â†’ A â†’ Type ğ“¥) â†’ Type (ğ“¤ âŠ” ğ“¥)
X / R = Trunc 2 (Coeq {A = tot R} left right)

module _ {ğ“¤ ğ“¥} {A : Type ğ“¤} {R : A â†’ A â†’ Type ğ“¥} where
  Î¹-quot : A â†’ A / R
  Î¹-quot a = Trunc.Î· (Î¹-coeq a)

  quot : (x : tot R ) â†’ Î¹-quot (left x) ï¼ Î¹-quot (right x)
  quot = ap Trunc.Î· âˆ˜ glue-coeq

  glue-quot : {x y : A} (r : R x y) â†’ Î¹-quot x ï¼ Î¹-quot y
  glue-quot {x} {y} r = quot (x , y , r)
}
%```

\p{We prove a number of elimination principles for set quotients.}

%```agda
\agda{
  opaque
    CoforkPâ†Quot-elim-data : âˆ€ {ğ“¦} {B : A / R  â†’ Type ğ“¦}
              â†’ â¦ƒ âˆ€ { x } â†’ Is-truncated 2 (B x) â¦„
              â†’ (f : âˆ€ x â†’ B (Î¹-quot x))
              â†’ (âˆ€ a â†’ Idáµˆ (ap B (quot a)) (f (left a)) (f (right a)))
              â†’ Coforkáµˆ left right (B âˆ˜ Trunc.Î·)
    CoforkPâ†Quot-elim-data {B = B} f f-R .fst = f
    CoforkPâ†Quot-elim-data {B = B} f f-R .snd =
      Î» a â†’ ap (Î» h â†’ coe  h (f (left a)))
               ((ap-âˆ˜ B Trunc.Î· ) (glue-coeq a)) âˆ™  f-R a


    Quot-elim : âˆ€ {ğ“¦} {B : A / R  â†’ Type ğ“¦}
              â†’ â¦ƒ âˆ€ { x } â†’ Is-truncated 2 (B x) â¦„
              â†’ (f : âˆ€ x â†’ B (Î¹-quot x))
              â†’ (âˆ€ a â†’ Idáµˆ (ap B (quot a)) (f (left a)) (f (right a)))
              â†’ âˆ€ x â†’ B x
    Quot-elim f f-R =
      Trunc.ind (Î» _ â†’ trunc!) (coeq-ind (CoforkPâ†Quot-elim-data f f-R))

    Quot-elimÎ² :  âˆ€ {ğ“¦} {B : A / R  â†’ Type ğ“¦}
              â†’ â¦ƒ H : âˆ€ { x } â†’ Is-truncated 2 (B x) â¦„
              â†’ (f : âˆ€ x â†’ B (Î¹-quot x))
              â†’ (f-R : âˆ€ a â†’ Idáµˆ (ap B (quot a)) (f (left a)) (f (right a)))
              â†’ Quot-elim f f-R âˆ˜ Î¹-quot ~ f
    Quot-elimÎ² {B = B} f f-R x =
      Quot-elim f f-R (Î¹-quot x)
        ï¼âŸ¨ Trunc.ind-Î² (Î» _ â†’ trunc!)
                        (coeq-ind (CoforkPâ†Quot-elim-data f f-R))
                        (Î¹-coeq x) âŸ©
      (coeq-ind (CoforkPâ†Quot-elim-data f f-R)) (Î¹-coeq x)
        ï¼âŸ¨ coeq-indÎ²  (CoforkPâ†Quot-elim-data f f-R) x âŸ©
      f x âˆ


    Quot-elim-prop : âˆ€ {ğ“¦} {B : A / R  â†’ Type ğ“¦}
                   â†’ â¦ƒ âˆ€ { x } â†’ Is-truncated 1 (B x) â¦„
                   â†’ (f : âˆ€ x â†’ B (Î¹-quot x))
                   â†’ âˆ€ x â†’ B x
    Quot-elim-prop f =
      Quot-elim {{ mk-trunc (suc-is-truncated 1 trunc!) }}
                f
                Î» a â†’ is-propâ†is-truncated trunc! _ _

    Quot-elim-propÎ² : âˆ€ {ğ“¦} {B : A / R  â†’ Type ğ“¦}
                   â†’ â¦ƒ H : âˆ€ { x } â†’ Is-truncated 1 (B x) â¦„
                   â†’ (f : âˆ€ x â†’ B (Î¹-quot x))
                   â†’  Quot-elim-prop {B = B} f âˆ˜ Î¹-quot ~ f
    Quot-elim-propÎ² f =
      Quot-elimÎ² {{ mk-trunc (suc-is-truncated 1 trunc!) }} f _


    Quot-rec : âˆ€ {ğ“¦} {B : Type ğ“¦}
             â†’ â¦ƒ Is-truncated 2 B â¦„
             â†’ (f : A â†’ B)
             â†’ (âˆ€ (x : tot R) â†’ f (left x) ï¼ f (right x))
             â†’ A / R â†’ B
    Quot-rec f p = Trunc.ind (Î» _ â†’ trunc!) (coeq-rec (f , p))

    Quot-recâ‚‚ : âˆ€ {ğ“¦} {B : Type ğ“¦}
              â†’ â¦ƒ Is-truncated 2 B â¦„
              â†’ (f : A â†’ A â†’ B)
              â†’ (âˆ€ (x : tot R) y â†’ f (left x) y ï¼ f (right x) y)
              â†’ (âˆ€ x (y : tot R)  â†’ f x (left y) ï¼ f x (right y))
              â†’ A / R â†’ A / R â†’ B
    Quot-recâ‚‚ f p q  =
      Trunc.ind (Î» _ â†’ trunc!)
                Î» x â†’ Trunc.ind (Î» _ â†’ trunc!)
                Î» y â†’ coeq-recâ‚‚
                      (f , p , q
                      , Î» _ _ â†’ mk-square ((is-setâ†is-truncated trunc! _ _) _ _)) x y

    Quot-recâ‚‚Î² : âˆ€ {ğ“¦} {B : Type ğ“¦}
              â†’ â¦ƒ H : Is-truncated 2 B â¦„
              â†’ (f : A â†’ A â†’ B)
              â†’ (p : âˆ€ (x : tot R) y â†’ f (left x) y ï¼ f (right x) y)
              â†’ (q : âˆ€ x (y : tot R)  â†’ f x (left y) ï¼ f x (right y))
              â†’ âˆ€ x y â†’ Quot-recâ‚‚ f p q (Î¹-quot x) (Î¹-quot y) ï¼ f x y
    Quot-recâ‚‚Î² {B = B} f p q x y =
      Quot-recâ‚‚ f p q (Î¹-quot x) (Î¹-quot y)
        ï¼âŸ¨  happly  (Trunc.ind-Î² _ _ (Î¹-coeq x)) (Î¹-quot y) âŸ©
      (Trunc.ind (Î» _ â†’ trunc!)
        Î» y â†’ coeq-recâ‚‚ BC (Î¹-coeq x) y) (Î¹-quot y)
        ï¼âŸ¨ Trunc.ind-Î² _ _ (Î¹-coeq y) âŸ©
      coeq-recâ‚‚ BC (Î¹-coeq x) (Î¹-coeq y) ï¼âŸ¨ coeq-recâ‚‚Î² BC x y âŸ©
        (f x y) âˆ
        where
          BC : BiCofork {Aâ‚ = tot R} {Aâ‚‚ = tot R} left right left right B
          BC = f , p , q , Î» _ _ â†’ mk-square ((is-setâ†is-truncated trunc! _ _) _ _)
}
%```
}
