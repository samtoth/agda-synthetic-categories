\title{Pushouts are functorial over the span diagram}
\author{samueltoth}
\date{2025-11-20}
\taxon{Module}
\import{stt-macros}

%```agda
\agda{
module Core.FunctorialPushout where

open import ufAxioms
open import Foundations.Prelude
open import Core.CanonicalPushouts
open import Core.SpanMap
}
%```


\subtree[stt-00B1]{
\title{Span maps induce functors of pushouts}
\taxon{Theorem}

%```agda
\agda{
Pushout-functorial-cocone
  : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“¤' ğ“¥' ğ“¦' ğ“›}
      {S : Span ğ“¤ ğ“¥ ğ“¦} {S' : Span ğ“¤' ğ“¥' ğ“¦'}
    â†’ let module S = Span S; module S' = Span S'
      in (F : Span-map S S')
      â†’ {P' : Type ğ“›} (Pc' : Cocone S' P')
      â†’ Cocone S P'
Pushout-functorial-cocone F Pc'
  = mk-cocone (Pc'.p âˆ˜ F.hâ‚) (Pc'.q âˆ˜ F.hâ‚ƒ)
              (  Pc'.p â—‚ F.H
              ~âˆ™ Pc'.filler â–¸ F.hâ‚‚
              ~âˆ™ Pc'.q â—‚ (F.K ~â»Â¹)) where
  module Pc' = Cocone Pc'
  module F = Span-map F

Pushout-mapâ†span-map : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“¤' ğ“¥' ğ“¦' ğ“œ ğ“›}
                {S : Span ğ“¤ ğ“¥ ğ“¦} {S' : Span ğ“¤' ğ“¥' ğ“¦'}
              â†’ let module S = Span S; module S' = Span S'
                in (F : Span-map S S')
                â†’ {P : Type ğ“œ} (Pc : Cocone S P)
                  (Po : is-pushoutÏ‰ S Pc)
                  {P' : Type ğ“›} (Pc' : Cocone S' P')
                â†’ P â†’ P'
Pushout-mapâ†span-map F pcc po pcc'
  = is-equiv.bwd po (Pushout-functorial-cocone F pcc')

Pushout-map-id
  : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“œ} {S : Span ğ“¤ ğ“¥ ğ“¦} {P : Type ğ“œ} {Pc : Cocone S P}
      (Po : is-pushoutÏ‰ S Pc)
    â†’ Pushout-mapâ†span-map id-span-map Pc Po
                           (Pushout-functorial-cocone id-span-map Pc)
    ï¼ id
Pushout-map-id po
  = ap (is-equiv.bwd po) (ap (mk-cocone _ _)
                         (funextâ†’ (Î» a â†’ âˆ™-reflr _ âˆ™ âˆ™-reflr _ âˆ™ sym (ap-id _))))
  âˆ™ is-equiv.Î· po id

Pushout-functorial-span
  : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“¤' ğ“¥' ğ“¦'}
      {S : Span ğ“¤ ğ“¥ ğ“¦} {S' : Span ğ“¤' ğ“¥' ğ“¦'}
    â†’ let module S = Span S; module S' = Span S'
      in (F : Span-map S S')
    â†’ Pushout S.left S.right â†’ Pushout S'.left S'.right
Pushout-functorial-span F = cogap (Pushout-functorial-cocone F pushout)

Canonical-pushout-map-id
  : âˆ€ {ğ“¤ ğ“¥ ğ“¦} {S : Span ğ“¤ ğ“¥ ğ“¦}
  â†’ Pushout-functorial-span (id-span-map {S = S}) ï¼ id
Canonical-pushout-map-id
  = sym (funextâ†’ (pushout-rec-unique _ _ ~refl ~refl
                   Î» a â†’ ap (_âˆ™ refl) (ap-id (glue a))))

Canonical-Pushout-map-compose
  : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“¤' ğ“¥' ğ“¦' ğ“¤'' ğ“¥'' ğ“¦''}
      {S : Span ğ“¤ ğ“¥ ğ“¦} {S' : Span ğ“¤' ğ“¥' ğ“¦'} {S'' : Span ğ“¤'' ğ“¥'' ğ“¦''}
      (F : Span-map S' S'') (G : Span-map S S')
    â†’ Pushout-functorial-span (compose-span-map F G)
    ï¼ Pushout-functorial-span F âˆ˜ Pushout-functorial-span G
Canonical-Pushout-map-compose {S = S} F G
  = sym (funextâ†’
          (pushout-rec-unique
            (Pushout-functorial-cocone (compose-span-map F G) pushout)
            (Pushout-functorial-span F âˆ˜ Pushout-functorial-span G)
            ~refl
            ~refl
            (~âˆ™-reflr _
            ~âˆ™ ap-âˆ˜ (Pushout-functorial-span F) (Pushout-functorial-span G) âˆ˜ glue
            ~âˆ™ (Î» x â†’ ap (ap (Pushout-functorial-span F)) (pushout-rec-apÎ² x))
            ~âˆ™ Î» xÂ â†’ ap-âˆ™âˆ™ (Pushout-functorial-span F)
                           (ap Î¹â‚ (G.H x)) (glue (G.hâ‚‚ x)) (ap Î¹â‚‚ (sym (G.K x)))
                    âˆ™   apâ‚ƒ (Î» x y z â†’ x âˆ™ y âˆ™ z)
                           (sym (ap-âˆ˜ (Pushout-functorial-span F) Î¹â‚ (G.H x)))
                           (pushout-rec-apÎ² (G.hâ‚‚ x))
                           (sym (ap-âˆ˜ (Pushout-functorial-span F) Î¹â‚‚ (sym (G.K x))))
                    âˆ™ lem))) where
    module F = Span-map F
    module G = Span-map G
    lem : {x : G.S.Centre} â†’
      ap (Î» a â†’ Î¹â‚ (F.hâ‚ a)) (G.H x) âˆ™
      (ap Î¹â‚ (F.H (G.hâ‚‚ x)) âˆ™
       glue (F.hâ‚‚ (G.hâ‚‚ x)) âˆ™ ap Î¹â‚‚ (sym (F.K (G.hâ‚‚ x))))
      âˆ™ ap (Î» a â†’ Î¹â‚‚ (F.hâ‚ƒ a)) (sym (G.K x))
      ï¼
      ap Î¹â‚ (ap F.hâ‚ (G.H x) âˆ™ F.H (G.hâ‚‚ x)) âˆ™
      glue (F.hâ‚‚ (G.hâ‚‚ x)) âˆ™ ap Î¹â‚‚ (sym (ap F.hâ‚ƒ (G.K x) âˆ™ F.K (G.hâ‚‚ x)))
    lem {x}
      = ap (Î¹â‚ âˆ˜ F.hâ‚) (G.H x) âˆ™
         (ap Î¹â‚ (F.H (G.hâ‚‚ x)) âˆ™
          glue (F.hâ‚‚ (G.hâ‚‚ x)) âˆ™ ap Î¹â‚‚ (sym (F.K (G.hâ‚‚ x))))
         âˆ™ ap (Î¹â‚‚ âˆ˜ F.hâ‚ƒ) (sym (G.K x))

          ï¼âŸ¨ apâ‚‚ _âˆ™_ (ap-âˆ˜ Î¹â‚ F.hâ‚ (G.H x))
                     (âˆ™-assoc (ap Î¹â‚ (F.H (G.hâ‚‚ x)))
                              (glue (F.hâ‚‚ (G.hâ‚‚ x)) âˆ™ ap Î¹â‚‚ (sym (F.K (G.hâ‚‚ x))))
                              (ap (Î¹â‚‚ âˆ˜ F.hâ‚ƒ) (sym (G.K x)))) âŸ©
        ap Î¹â‚ (ap F.hâ‚ (G.H x)) âˆ™
         ap Î¹â‚ (F.H (G.hâ‚‚ x)) âˆ™
         (glue (F.hâ‚‚ (G.hâ‚‚ x)) âˆ™ ap Î¹â‚‚ (sym (F.K (G.hâ‚‚ x)))) âˆ™
         ap (Î¹â‚‚ âˆ˜ F.hâ‚ƒ) (sym (G.K x))

         ï¼âŸ¨ sym (âˆ™-assoc (ap Î¹â‚ (ap F.hâ‚ (G.H x))) (ap Î¹â‚ (F.H (G.hâ‚‚ x))) _)
             âˆ™ ap (_âˆ™ _) (sym (ap-âˆ™ Î¹â‚ (ap F.hâ‚ (G.H x)) (F.H (G.hâ‚‚ x)))) âŸ©

        ap Î¹â‚ (ap F.hâ‚ (G.H x) âˆ™ F.H (G.hâ‚‚ x)) âˆ™
         (glue (F.hâ‚‚ (G.hâ‚‚ x)) âˆ™ ap Î¹â‚‚ (sym (F.K (G.hâ‚‚ x)))) âˆ™
         ap (Î¹â‚‚ âˆ˜ F.hâ‚ƒ) (sym (G.K x))

         ï¼âŸ¨ ap (ap Î¹â‚ (ap F.hâ‚ (G.H x) âˆ™ F.H (G.hâ‚‚ x)) âˆ™_)
              (âˆ™-assoc (glue (F.hâ‚‚ (G.hâ‚‚ x))) _ _
              âˆ™ ap (glue (F.hâ‚‚ (G.hâ‚‚ x)) âˆ™_)
                   (ap (ap Î¹â‚‚ _ âˆ™_) (ap-âˆ˜ Î¹â‚‚ F.hâ‚ƒ (sym (G.K x))
                                    âˆ™ ap (ap Î¹â‚‚) (ap-sym F.hâ‚ƒ (G.K x)))
                   âˆ™ sym (ap-âˆ™ Î¹â‚‚ (sym (F.K (G.hâ‚‚ x))) _)
                   âˆ™ ap (ap Î¹â‚‚) ( sym (âˆ™-symsym (ap F.hâ‚ƒ (G.K x)) (F.K (G.hâ‚‚ x)))))) âŸ©

        ap Î¹â‚ (ap F.hâ‚ (G.H x) âˆ™ F.H (G.hâ‚‚ x)) âˆ™
         glue (F.hâ‚‚ (G.hâ‚‚ x)) âˆ™ ap Î¹â‚‚ (sym (ap F.hâ‚ƒ (G.K _) âˆ™ F.K (G.hâ‚‚ _))) âˆ

}
%```
}
