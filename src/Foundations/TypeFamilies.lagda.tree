\title{Type Families}
\taxon{Module}
\date{2026-02-18}
\author{fredrikbakke}

\import{stt-macros}

%```agda
\agda{
module Foundations.TypeFamilies where

open import Foundations.Universes
open import Foundations.Sigma
open import Foundations.Functions
open import Foundations.SigmaProperties
open import Foundations.Identity
open import Foundations.CoherentIsomorphism
}
%```

\subtree{
\title{Type families and dependent type families}
\taxon{Definition}

\p{
A \em{type family} is a function #{B : A â†’ ğ“¤}. A \em{dependent type family} over the
type family #{B : A â†’ ğ“¤} is a function #{Y : (a : A) â†’ X\,a â†’ ğ“¥}.
}

%```agda
\agda{
Fam : (ğ“¤1 ğ“¤2 : Level) â†’ Type (lsuc ğ“¤1 âŠ” lsuc ğ“¤2)
Fam ğ“¤1 ğ“¤2 = Î£ (Type ğ“¤1) (Î» X â†’ X â†’ Type ğ“¤2)

DepFam
  : {ğ“¤1 ğ“¤2 : Level}
  â†’ (ğ“¤3 ğ“¤4 : Level)
  â†’ Fam ğ“¤1 ğ“¤2
  â†’ Type (ğ“¤1 âŠ” lsuc ğ“¤3 âŠ” lsuc ğ“¤4)
DepFam ğ“¤3 ğ“¤4 (A , B)
  = Î£ (A â†’ Type ğ“¤3)
      (Î» X â†’ (a : A) â†’ X a â†’ Type ğ“¤4)

DepÂ²Fam
  : {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 : Level}
  â†’ (ğ“¤5 ğ“¤6 : Level)
  â†’ (F : Fam ğ“¤1 ğ“¤2)
  â†’ DepFam ğ“¤3 ğ“¤4 F
  â†’ Type (ğ“¤1 âŠ” ğ“¤3 âŠ” lsuc ğ“¤5 âŠ” lsuc ğ“¤6)
DepÂ²Fam ğ“¤5 ğ“¤6 (A , B) (X , Y)
  = Î£ ((a : A) â†’ X a â†’ Type ğ“¤5)
      (Î» U â†’ (a : A) (x : X a) â†’ U a x â†’ Type ğ“¤6)
}
%```
}

\subtree{
\title{Equivalences of type families}
\taxon{Definition}

%```agda
\agda{
module _
  {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 : Level}
  (F@(A , B) : Fam ğ“¤1 ğ“¤2)
  (G@(X , Y) : Fam ğ“¤3 ğ“¤4)
  where

  infix 7 _â‰ƒá¶ _
  _â‰ƒá¶ _ : Type (ğ“¤1 âŠ” ğ“¤2 âŠ” ğ“¤3 âŠ” ğ“¤4)
  _â‰ƒá¶ _ = Î£ (A â‰ƒ X) (Î» e â†’ (a : A) â†’ B a â‰ƒ Y (e ._â‰ƒ_.fwd a))
}
%```
}

\subtree{
\title{Straighteningâ€“unstraightening for type families}
\taxon{construction}

%```agda
\agda{
arrâ†Fam
  : {ğ“¤1 ğ“¤2 : Level}
    (F : Fam ğ“¤1 ğ“¤2)
  â†’ Î£ (fst F) (snd F) â†’ fst F
arrâ†Fam F = fst

arrâ†Fam-fibre-fam
  : {ğ“¤1 ğ“¤2 : Level}
    {A : Type ğ“¤1}
    {B : Type ğ“¤2}
    (f : A â†’ B)
  â†’ arrâ†Fam (fibre-fam f) ï¼ fst
arrâ†Fam-fibre-fam f = refl

fibre-fam-arrâ†Famâ‰ƒá¶ 
  : {ğ“¤1 ğ“¤2 : Level}
    (F : Fam ğ“¤1 ğ“¤2)
  â†’ fibre-fam (arrâ†Fam F) â‰ƒá¶  F
fibre-fam-arrâ†Famâ‰ƒá¶  (A , B)
  = idequiv , fibre-straighten B
}
%```
}

\subtree{
\title{Dependent type families from nondependent type families}
\taxon{Definition}

%```agda
\agda{
module _
  {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 : Level}
  (F@(A , B) : Fam ğ“¤1 ğ“¤2)
  (G@(X , Y) : Fam ğ“¤3 ğ“¤4)
  where

  Famâ†’DepFam : DepFam ğ“¤3 ğ“¤4 F
  Famâ†’DepFam = ((Î» _ â†’ X) , (Î» _ â†’ Y))

  Famâ†’DepÂ²Fam
    : {ğ“¤5 ğ“¤6 : Level}
    â†’ Fam ğ“¤5 ğ“¤6
    â†’ DepÂ²Fam ğ“¤5 ğ“¤6 F Famâ†’DepFam
  Famâ†’DepÂ²Fam (U , V)
    = ((Î» _ _ â†’ U) , (Î» _ _ â†’ V))

  DepFamâ†’DepÂ²Fam
    : {ğ“¤5 ğ“¤6 : Level}
    â†’ DepFam ğ“¤5 ğ“¤6 G
    â†’ DepÂ²Fam ğ“¤5 ğ“¤6 F Famâ†’DepFam
  DepFamâ†’DepÂ²Fam (U , V)
    = ((Î» _ â†’ U) , (Î» _ â†’ V))
}
%```
}

\subtree{
\title{Identity and composition of equivalences of type families}
\taxon{Definition}

%```agda
\agda{
idâ‰ƒá¶  : âˆ€ {ğ“¤1 ğ“¤2} (F : Fam ğ“¤1 ğ“¤2) â†’ F â‰ƒá¶  F
idâ‰ƒá¶  (A , B) = idequiv , (Î» _ â†’ idequiv)

concatâ‰ƒá¶ 
  : âˆ€ {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 ğ“¤5 ğ“¤6}
      (F : Fam ğ“¤1 ğ“¤2)
      (G : Fam ğ“¤3 ğ“¤4)
      (H : Fam ğ“¤5 ğ“¤6)
    â†’ F â‰ƒá¶  G
    â†’ G â‰ƒá¶  H
    â†’ F â‰ƒá¶  H
concatâ‰ƒá¶  F G H (e , ef) (e' , eg)
  = e âˆ™â‰ƒ e'
  , (Î» a â†’ ef a âˆ™â‰ƒ eg (e ._â‰ƒ_.fwd a))

}
%```
}

\subtree{
\title{Equivalences of dependent type families over a fixed base}
\taxon{Definition}

%```agda
\agda{
â‰ƒáµˆá¶ -over
  : {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 ğ“¤5 ğ“¤6 : Level}
    (F@(A , B) : Fam ğ“¤1 ğ“¤2)
    (G@(X , Y) : DepFam ğ“¤3 ğ“¤4 F)
    (H@(U , V) : DepFam ğ“¤5 ğ“¤6 F)
  â†’ Type (ğ“¤1 âŠ” ğ“¤3 âŠ” ğ“¤4 âŠ” ğ“¤5 âŠ” ğ“¤6)
â‰ƒáµˆá¶ -over F (X , Y) (U , V)
  = (a : fst F) â†’ (X a , Y a) â‰ƒá¶  (U a , V a)

syntax â‰ƒáµˆá¶ -over F G H = G â‰ƒáµˆá¶ âŸ¦ F âŸ§ H
}
%```
}

\subtree{
\title{Identity and composition of dependent family equivalences}
\taxon{Definition}

%```agda
\agda{
idâ‰ƒáµˆá¶ 
  : {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 : Level}
    (F : Fam ğ“¤1 ğ“¤2)
    (G@(X , Y) : DepFam ğ“¤3 ğ“¤4 F)
  â†’ G â‰ƒáµˆá¶ âŸ¦ F âŸ§ G
idâ‰ƒáµˆá¶  F (X , Y) a = idâ‰ƒá¶  (X a , Y a)

concatâ‰ƒáµˆá¶ 
  : {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 ğ“¤5 ğ“¤6 ğ“¤7 ğ“¤8 : Level}
    (F : Fam ğ“¤1 ğ“¤2)
    (G : DepFam ğ“¤3 ğ“¤4 F)
    (H : DepFam ğ“¤5 ğ“¤6 F)
    (K : DepFam ğ“¤7 ğ“¤8 F)
  â†’ G â‰ƒáµˆá¶ âŸ¦ F âŸ§ H
  â†’ H â‰ƒáµˆá¶ âŸ¦ F âŸ§ K
  â†’ G â‰ƒáµˆá¶ âŸ¦ F âŸ§ K
concatâ‰ƒáµˆá¶  F (X , Y) (U , V) (P , Q) e e' a
  = concatâ‰ƒá¶  (X a , Y a) (U a , V a) (P a , Q a) (e a) (e' a)
}
%```
}
