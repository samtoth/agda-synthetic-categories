\title{Type Families}
\taxon{Module}
\date{2026-02-18}
\author{fredrikbakke}

\import{stt-macros}

\subtree{
\title{Type families and dependent type families}
\taxon{Definition}

%```agda
\agda{
module Foundations.TypeFamilies where

open import Foundations.Universes
open import Foundations.Sigma
open import Foundations.CoherentIsomorphism

Fam : (ğ“¤1 ğ“¤2 : Level) â†’ Type (lsuc ğ“¤1 âŠ” lsuc ğ“¤2)
Fam ğ“¤1 ğ“¤2 = Î£ (Type ğ“¤1) (Î» X â†’ X â†’ Type ğ“¤2)

DepFam
  : {ğ“¤1 ğ“¤2 : Level}
  â†’ (ğ“¤3 ğ“¤4 : Level)
  â†’ Fam ğ“¤1 ğ“¤2
  â†’ Type (ğ“¤1 âŠ” lsuc ğ“¤3 âŠ” lsuc ğ“¤4)
DepFam ğ“¤3 ğ“¤4 (A , B) = Î£ (A â†’ Type ğ“¤3) (Î» X â†’ (a : A) â†’ X a â†’ Type ğ“¤4)

DepÂ²Fam
  : {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 : Level}
  â†’ (ğ“¤5 ğ“¤6 : Level)
  â†’ (F : Fam ğ“¤1 ğ“¤2)
  â†’ DepFam ğ“¤3 ğ“¤4 F
  â†’ Type (ğ“¤1 âŠ” ğ“¤3 âŠ” lsuc ğ“¤5 âŠ” lsuc ğ“¤6)
DepÂ²Fam ğ“¤5 ğ“¤6 (A , B) (X , Y)
  = Î£ ((a : A) â†’ X a â†’ Type ğ“¤5)
      (Î» U â†’ (a : A) (x : X a) â†’ U a x â†’ Type ğ“¤6)
}
%```
}

\subtree{
\title{Dependent type families from nondependent type families}
\taxon{Definition}

%```agda
\agda{
module _
  {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 : Level}
  (F@(A , B) : Fam ğ“¤1 ğ“¤2)
  (G@(X , Y) : Fam ğ“¤3 ğ“¤4)
  where

  Famâ†’DepFam : DepFam ğ“¤3 ğ“¤4 F
  Famâ†’DepFam = ((Î» _ â†’ X) , (Î» _ x â†’ Y x))

  Famâ†’DepÂ²Fam : {ğ“¤5 ğ“¤6 : Level}
              â†’ Fam ğ“¤5 ğ“¤6
              â†’ DepÂ²Fam ğ“¤5 ğ“¤6 F Famâ†’DepFam
  Famâ†’DepÂ²Fam (U , V) = ((Î» _ _ â†’ U) , (Î» _ _ u â†’ V u))

  DepFamâ†’DepÂ²Fam : {ğ“¤5 ğ“¤6 : Level}
                 â†’ DepFam ğ“¤5 ğ“¤6 G
                 â†’ DepÂ²Fam ğ“¤5 ğ“¤6 F Famâ†’DepFam
  DepFamâ†’DepÂ²Fam (U , V) = ((Î» _ x â†’ U x) , (Î» _ x u â†’ V x u))
}
%```
}

\subtree{
\title{Equivalences of type families}
\taxon{Definition}

%```agda
\agda{
module _
  {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 : Level}
  (F@(A , B) : Fam ğ“¤1 ğ“¤2)
  (G@(X , Y) : Fam ğ“¤3 ğ“¤4)
  where

  infix 7 _â‰ƒá¶ _
  _â‰ƒá¶ _ : Type (ğ“¤1 âŠ” ğ“¤2 âŠ” ğ“¤3 âŠ” ğ“¤4)
  _â‰ƒá¶ _ = Î£ (A â‰ƒ X) (Î» e â†’ (a : A) â†’ B a â‰ƒ Y (e ._â‰ƒ_.fwd a))
}
%```
}

\subtree{
\title{Identity and composition of equivalences of type families}
\taxon{Definition}

%```agda
\agda{
idâ‰ƒá¶ 
  : âˆ€ {ğ“¤1 ğ“¤2} (F : Fam ğ“¤1 ğ“¤2) â†’ F â‰ƒá¶  F
idâ‰ƒá¶  (A , B) = idequiv , (Î» _ â†’ idequiv)

infixl 15 _âˆ™â‰ƒá¶ _

_âˆ™â‰ƒá¶ _
  : âˆ€ {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 ğ“¤5 ğ“¤6}
      {F : Fam ğ“¤1 ğ“¤2}
      {G : Fam ğ“¤3 ğ“¤4}
      {H : Fam ğ“¤5 ğ“¤6}
    â†’ F â‰ƒá¶  G
    â†’ G â‰ƒá¶  H
    â†’ F â‰ƒá¶  H
(e , ef) âˆ™â‰ƒá¶  (e' , eg)
  = e âˆ™â‰ƒ e'
  , (Î» a â†’ ef a âˆ™â‰ƒ eg (e ._â‰ƒ_.fwd a))

}
%```
}

\subtree{
\title{Equivalences of dependent type families over a fixed base}
\taxon{Definition}

%```agda
\agda{
â‰ƒáµˆá¶ -over
  : âˆ€ {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 ğ“¤5 ğ“¤6}
      (F@(A , B) : Fam ğ“¤1 ğ“¤2)
      (G@(X , Y) : DepFam ğ“¤3 ğ“¤4 F)
      (H@(U , V) : DepFam ğ“¤5 ğ“¤6 F)
    â†’ Type (ğ“¤1 âŠ” ğ“¤3 âŠ” ğ“¤4 âŠ” ğ“¤5 âŠ” ğ“¤6)
â‰ƒáµˆá¶ -over F (X , Y) (U , V) = (a : fst F) â†’ (X a , Y a) â‰ƒá¶  (U a , V a)

syntax â‰ƒáµˆá¶ -over F G H = G â‰ƒáµˆá¶ âŸ¦ F âŸ§ H
}
%```
}

\subtree{
\title{Identity and composition of dependent family equivalences}
\taxon{Definition}

%```agda
\agda{
idâ‰ƒáµˆá¶ 
  : âˆ€ {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4}
      (F : Fam ğ“¤1 ğ“¤2)
      (G@(X , Y) : DepFam ğ“¤3 ğ“¤4 F)
    â†’ G â‰ƒáµˆá¶ âŸ¦ F âŸ§ G
idâ‰ƒáµˆá¶  F (X , Y) a = idâ‰ƒá¶  (X a , Y a)

infixl 14 _âˆ™â‰ƒáµˆá¶ _

_âˆ™â‰ƒáµˆá¶ _
  : âˆ€ {ğ“¤1 ğ“¤2 ğ“¤3 ğ“¤4 ğ“¤5 ğ“¤6 ğ“¤7 ğ“¤8}
      {F : Fam ğ“¤1 ğ“¤2}
      {G : DepFam ğ“¤3 ğ“¤4 F}
      {H : DepFam ğ“¤5 ğ“¤6 F}
      {K : DepFam ğ“¤7 ğ“¤8 F}
    â†’ G â‰ƒáµˆá¶ âŸ¦ F âŸ§ H
    â†’ H â‰ƒáµˆá¶ âŸ¦ F âŸ§ K
    â†’ G â‰ƒáµˆá¶ âŸ¦ F âŸ§ K
_âˆ™â‰ƒáµˆá¶ _ {F = F} {G = (X , Y)} {H = (U , V)} {K = (P , Q)} e e'
  = Î» a
  â†’ _âˆ™â‰ƒá¶ _
      {F = (X a , Y a)}
      {G = (U a , V a)}
      {H = (P a , Q a)}
      (e a)
      (e' a)
}
%```
}
