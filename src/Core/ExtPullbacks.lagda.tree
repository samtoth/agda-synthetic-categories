\date{2025-08-12}
\title{Pullbacks using Identity systems}
\taxon{module}
\meta{module}{Core.ExtPullbacks}
\author{samueltoth}
\import{stt-macros}

%```agda
\agda{
module Core.ExtPullbacks where

open import Foundations.Prelude
open import Ergonomics.Extensionality
open import ufAxioms
}
%```

\p{
We can define pullbacks (and other limits such as fibres) using
for types with non standard (identity systems)[TODO-WRITEUP].
This is particularly usefull for example when a type is locally small,
and we can construct small pullbacks over it.
}

\subtree[stt-008U]{
\title{Pullbacks using identity systems}
\taxon{construction}

%```agda
\agda{
Pullbackâ‚‘ : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“˜} {A : Type ğ“¤} {B : Type ğ“¥} {C : Type ğ“¦}
              (f : A â†’ C) (g : B â†’ C)
              â¦ƒ IdC : Identity-system C ğ“˜ â¦„
            â†’ Type (ğ“¤ âŠ” ğ“¥ âŠ” ğ“˜)
Pullbackâ‚‘ {A = A} {B} f g = Î£[ a âˆ¶ A ] Î£[ b âˆ¶ B ] (f a ï¼â‚‘ g b)

pullbackâ‚‘ : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“˜} {A : Type ğ“¤} {B : Type ğ“¥} {C : Type ğ“¦}
              (f : A â†’ C) (g : B â†’ C)
              â¦ƒ IdC : Identity-system C ğ“˜ â¦„
            â†’ Cone (mk-cospan C f g) (Pullbackâ‚‘ f g)
pullbackâ‚‘ f g = mk-cone fst (fst âˆ˜ snd) (ext! âˆ˜ snd âˆ˜ snd)

pullbackâ‚‘-is-pullback
  : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“˜} {A : Type ğ“¤} {B : Type ğ“¥} {C : Type ğ“¦}
      (f : A â†’ C) (g : B â†’ C)
      â¦ƒ IdC : Identity-system C ğ“˜ â¦„
    â†’ is-pullbackÏ‰ (mk-cospan C f g) (pullbackâ‚‘ f g)
pullbackâ‚‘-is-pullback f g
  = is-pullbackâ†gap _ (is-total-equivâ†is-fibrewise-equiv (Î»
      a â†’ is-total-equivâ†is-fibrewise-equiv (Î»
        b â†’ ext!-is-equiv)))

module pbâ‚‘ {ğ“¤ ğ“¥ ğ“¦ ğ“˜} {A : Type ğ“¤} {B : Type ğ“¥} {C : Type ğ“¦}
           â¦ƒ IdC : Identity-system C ğ“˜ â¦„ {f : A â†’ C} {g : B â†’ C}
       = Cone (pullbackâ‚‘ f g) renaming (i to Ï€â‚; j to Ï€â‚‚)
}
%```
}

\subtree[stt-008V]{
\title{Fibres using identy systems}
\taxon{construction}

%```
\agda{
fibreâ‚‘ : âˆ€ {ğ“¤ ğ“¥ ğ“˜} {A : Type ğ“¤} {B : Type ğ“¥}
           â¦ƒ s : Identity-system B ğ“˜ â¦„
         â†’ (A â†’ B) â†’ B â†’ Type (ğ“¤ âŠ” ğ“˜)
fibreâ‚‘ {A = A} f b = Î£[ a âˆ¶ A ] (f a ï¼â‚‘ b)

fibreâ‚‘-cone : âˆ€ {ğ“¤ ğ“¥ ğ“˜} {A : Type ğ“¤} {B : Type ğ“¥}
                â¦ƒ s : Identity-system B ğ“˜ â¦„
              â†’ (f : A â†’ B) (b : B)
              â†’ Cone (mk-cospan _ f (const _ ğŸ™ b)) (fibreâ‚‘ f b)
fibreâ‚‘-cone f b = mk-cone fst ! (ext! âˆ˜ snd)

fibreâ‚‘-is-pullback
  : âˆ€ {ğ“¤ ğ“¥ ğ“˜} {A : Type ğ“¤} {B : Type ğ“¥}
      â¦ƒ s : Identity-system B ğ“˜ â¦„
    â†’ (f : A â†’ B) (b : B)
    â†’ is-pullbackÏ‰ _ (fibreâ‚‘-cone f b)
fibreâ‚‘-is-pullback f b = is-pullbackâ†gap _
  (is-total-equivâ†is-fibrewise-equiv (Î» a
    â†’ is-equiv-âˆ˜
            (is-equivâ»Â¹ (Î£-singl ğŸ™-is-singleton tt ._â‰ƒ_.has-is-eqv))
            ext!-is-equiv))
}
%```
}

