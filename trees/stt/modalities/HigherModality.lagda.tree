\date{2025-02-21}
\title{Higher Modalities}

\import{stt-macros}

% ```agda
\agda{
module modalities.HigherModality where

open import foundations.Prelude
open import ufAxioms
open import ergonomics.Universal 
open import ergonomics.Extensionality
}
% ```

\transclude{stt-000G}


% ```agda
\agda{
record HigherModality : TypeÏ‰ where
  field
    â—‹_ : âˆ€ {ğ“¤} â†’ Type ğ“¤ â†’ Type ğ“¤
    â—‹-Î· : âˆ€ {ğ“¤} {A : Type ğ“¤} â†’ A â†’ â—‹ A
    â—‹-ind : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} (P : â—‹ A â†’ Type ğ“¥) â†’ (f : (a : A) â†’ â—‹ P (â—‹-Î· a)) â†’ (ma : â—‹ A) â†’ â—‹ (P ma)
    â—‹-Î² : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} (P : â—‹ A â†’ Type ğ“¥) â†’ (f : (a : A) â†’ â—‹ P (â—‹-Î· a)) â†’ (a : A) â†’ â—‹-ind P f (â—‹-Î· a) ï¼ f a

  is-â—‹-modal : âˆ€ {ğ“¤} â†’ Type ğ“¤ â†’ Type ğ“¤
  is-â—‹-modal A = is-equiv (â—‹-Î· {A = A})

  field
    ï¼-is-â—‹-modal : âˆ€ {ğ“¤} {A : Type ğ“¤} {x y : A} â†’ is-â—‹-modal (x ï¼ y)

  opaque
    â—‹-rec : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {B : Type ğ“¥} â†’ (A â†’ â—‹ B) â†’ (â—‹ A â†’ â—‹ B) 
    â—‹-rec = â—‹-ind (Î» _ â†’ _)

    â—‹-recÎ² :  âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {B : Type ğ“¥} (f : A â†’ â—‹ B) (a : A) â†’ â—‹-rec f (â—‹-Î· a) ï¼ f a
    â—‹-recÎ² = â—‹-Î² (Î» _ â†’ _)

  unmod : âˆ€ {ğ“¤} {A : Type ğ“¤} (m : is-â—‹-modal A) â†’ â—‹ A â†’ A
  unmod (mk-eqv (g , _) _) = g
}
% ```

\subtree{
\taxon{theorem}
\title{#{\bigcirc A} is modal}

% ```agda
\agda{
  â—‹-elim : âˆ€ {ğ“¤} {A : Type ğ“¤} â†’ â—‹ (â—‹ A) â†’ â—‹ A
  â—‹-elim = â—‹-rec Î» x â†’ x

  â—‹-is-â—‹-modal : âˆ€ {ğ“¤} {A : Type ğ“¤} â†’ is-â—‹-modal (â—‹ A)
  â—‹-is-â—‹-modal = is-equivâ†qiso the-iso where
    the-iso : quasi-iso â—‹-Î·
    the-iso .fst = â—‹-ind _ id
    the-iso .snd .fst = â—‹-Î² _ id
    the-iso .snd .snd a = unmod ï¼-is-â—‹-modal (â—‹-ind (Î» a â†’ (â—‹-Î· (â—‹-ind _ id a)) ï¼ a)
                 (Î» a â†’ â—‹-Î· (ap â—‹-Î· (â—‹-Î² _ _ a))) a)
}
% ```
}

\subtree{
\taxon{definition}
\title{Modal induction}

% ```agda
\agda{
  opaque 
    â—‹-ind' : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {P : â—‹ A â†’ Type ğ“¥} (P-mod : âˆ€ {a} â†’ is-â—‹-modal (P a))
             â†’ (f : (a : A) â†’ P (â—‹-Î· a)) â†’ (ma : â—‹ A) â†’ P ma
    â—‹-ind' {P = P} is-mod f = (unmod is-mod) âˆ˜ â—‹-ind P (â—‹-Î· âˆ˜ f)

    â—‹-Î²' : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {P : â—‹ A â†’ Type ğ“¥}
           â†’ (P-mod : âˆ€ {a} â†’ is-â—‹-modal (P a))
           â†’ (f : (a : A) â†’ P (â—‹-Î· a)) â†’ (a : A) â†’ â—‹-ind' (Î» {a'} â†’ P-mod {a'}) f (â—‹-Î· a) ï¼ f a
    â—‹-Î²' is-mod f a = ap (unmod is-mod) (â—‹-Î² _ _ a) âˆ™ is-equiv.Î· is-mod (f a)

    â—‹-ind'-qiso : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {P : â—‹ A â†’ Type ğ“¥} {P-mod : âˆ€ {a} â†’ is-â—‹-modal (P a)}
                   â†’ quasi-iso {A = (a : A) â†’ P (â—‹-Î· a)} {B = (a : â—‹ A) â†’ P a}
                               (â—‹-ind' P-mod)
    â—‹-ind'-qiso .fst = _âˆ˜ â—‹-Î·
    â—‹-ind'-qiso {P-mod = is-mod} .snd .fst f = ext! (â—‹-Î²' is-mod f) 
    â—‹-ind'-qiso {P = P} {P-mod = is-mod} .snd .snd f = ext! (â—‹-ind' {P = Î» a â†’ _ ï¼ f a}
                     (Î» {a} â†’ ï¼-is-â—‹-modal {y = f a}) (â—‹-Î²' is-mod (f âˆ˜ â—‹-Î·)))

    â—‹-ind'-is-equiv : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {P : â—‹ A â†’ Type ğ“¥}
                       {P-mod : âˆ€ {a} â†’ is-â—‹-modal (P a)}
                   â†’ is-equiv {A = (a : A) â†’ P (â—‹-Î· a)} {B = (a : â—‹ A) â†’ P a}
                               (â—‹-ind' P-mod)
    â—‹-ind'-is-equiv {P-mod = is-mod} = is-equivâ†qiso (â—‹-ind'-qiso {P-mod = is-mod})

}
% ```
}


\subtree{
\taxon{universal property}
% ```agda
\agda{
module _ {M : HigherModality} where

  open HigherModality M

  â—‹-ind-qiso : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {P : â—‹ A â†’ Type ğ“¥}
                 â†’ quasi-iso {A = (a : A) â†’ â—‹ P (â—‹-Î· a)} {B = (a : â—‹ A) â†’ â—‹ (P a)}
                            (â—‹-ind P)
  â—‹-ind-qiso .fst = _âˆ˜ â—‹-Î·
  â—‹-ind-qiso .snd .fst f = ext! (â—‹-Î² _ f)
  â—‹-ind-qiso {A = A} {P = P} .snd .snd f = ext! (â—‹-ind' ï¼-is-â—‹-modal (â—‹-Î² _ (f âˆ˜ â—‹-Î·)))

  â—‹-ind-is-equiv : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {P : â—‹ A â†’ Type ğ“¥}
                 â†’ is-equiv {A = (a : A) â†’ â—‹ P (â—‹-Î· a)} {B = (a : â—‹ A) â†’ â—‹ P a}
                            (â—‹-ind P)
  â—‹-ind-is-equiv = is-equivâ†qiso â—‹-ind-qiso


  open Universal

  instance
    Universal-â—‹ : âˆ€ {ğ“¤ ğ“¥ ğ“¦} {A : Type ğ“¤} {P : â—‹ A â†’ Type ğ“¥}
                 â†’ â¦ƒ _ : âˆ€ {a} â†’ is-â—‹-modal (P a) â¦„
                 â†’ â¦ƒ _ : Universal ((a : A) â†’ P (â—‹-Î· a)) ğ“¦ â¦„
                 â†’ Universal ((a : â—‹ A) â†’ P a) ğ“¦
    Universal-â—‹ â¦ƒ mod â¦„ â¦ƒ u â¦„ .Universal.methods = u .methods
    Universal-â—‹ â¦ƒ mod â¦„ â¦ƒ u â¦„ .Universal.from = â—‹-ind' mod âˆ˜ u .from
    Universal-â—‹ â¦ƒ mod â¦„ â¦ƒ u â¦„ .Universal.from-is-equiv = is-equiv-âˆ˜ â—‹-ind'-is-equiv (u .from-is-equiv)
}
% ```
}

\subtree{

\title{Instance resolution for is-modal}

% ```agda
\agda{
  instance
    â—‹-Modal : âˆ€ {ğ“¤} {A : Type ğ“¤} â†’ is-â—‹-modal (â—‹ A)
    â—‹-Modal = â—‹-is-â—‹-modal

    ï¼-Modal : âˆ€ {ğ“¤} {A : Type ğ“¤} {a b : A} â†’ is-â—‹-modal (a ï¼ b)
    ï¼-Modal = ï¼-is-â—‹-modal

  test : âˆ€ {ğ“¤} {A : Type ğ“¤} â†’ â—‹ â—‹ A â†’ â—‹ A
  test = ind! â—‹-Î·


}
% ```


}

\subtree{
\taxon{theorem}
\title{Higher modalities are #{\Sigma}-closed}

% ```agda
\agda{
  -- instance
--     Modal-Î£ : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {B : A â†’ Type ğ“¥}
--             â†’ â¦ƒ _ : is-â—‹-modal A â¦„
--             â†’ â¦ƒ _ : âˆ€ {x} â†’ is-â—‹-modal (B x) â¦„
--             â†’ is-â—‹-modal (Î£ A B)
--     Modal-Î£ = {!!}
}
% ```

}
