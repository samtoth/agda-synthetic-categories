\date{2025-04-19}
\taxon{module}
\title{(Co)Spans and (co)cones}
\import{stt-macros}
\author{samueltoth}
\meta{module}{\startverb foundations.Span \stopverb}

% ```agda
\agda{
module foundations.Span where

open import foundations.Universes
open import foundations.Functions
open import foundations.Homotopy
open import foundations.FunExt
open import foundations.Identity
open import foundations.Sigma
}
% ```

\subtree[stt-0015]{
\taxon{definition}
\meta{defines}{\startverb ["Span", "Span.Centre",
                           "Span.left", "Span.right", "mk-span"] \stopverb}
\title{Spans}

\p{
    A span is a diagram of types: #{C \xleftarrow{f} A \xrightarrow{g} B}.
}

% ```agda
\agda{
record Span ğ“¤ ğ“¥ ğ“¦ : Type (lsuc (ğ“¤ âŠ” ğ“¥ âŠ” ğ“¦)) where
  constructor mk-span
  field
    Centre : Type ğ“¤
    {Left} : Type ğ“¥
    left   : Centre â†’ Left
    {Right} : Type ğ“¦
    right : Centre â†’ Right
}
% ```
}


\subtree[stt-0016]{
 \taxon{definition}
 \title{cocone}
 \meta{defines}{\startverb ["Cocone", "Cocone.p",
                            "Cocone.q", "Cocone.filler",
                            "mk-cocone"] \stopverb}

 \p{
  Given a span #{s : C \xleftarrow{f} A \xrightarrow{g} B}, and a type #{Q}, we define the type of #{Q}-cocones over #{s} to be the structure with:
   \ul{
     \li{A function #{p : C \to Q}}
     \li{A function #{q : B \to Q}}
     \li{A path #{p \circ f = q \circ g}}
}
}

% ```agda
\agda{
record Cocone  {ğ“¤ ğ“¥ ğ“¦} (S : Span ğ“¤ ğ“¥ ğ“¦) {ğ“›} (Carrier : Type ğ“›)
        : Type (lsuc (ğ“¤ âŠ” ğ“¥ âŠ” ğ“¦ âŠ” ğ“›))  where
  constructor mk-cocone
  open Span S
  field
    p       : Left â†’ Carrier
    q       : Right â†’ Carrier
    filler  : p âˆ˜ left ~ q âˆ˜ right 


Cocone-pathâ†’ : âˆ€ {ğ“¤ ğ“¥ ğ“¦} {S : Span ğ“¤ ğ“¥ ğ“¦} {ğ“›} {X : Type ğ“›}
               â†’ FunExtÏ‰ ğ“›
               â†’ (c c' : Cocone S X)
               â†’ (p : c .Cocone.p ï¼ c' .Cocone.p)
               â†’ (q : c .Cocone.q ï¼ c' .Cocone.q)
               â†’ (c .Cocone.filler ~âˆ™ happly q â–¸ S .Span.right
                    ~ happly p â–¸ S .Span.left ~âˆ™ c' .Cocone.filler)
               â†’ c ï¼ c'
Cocone-pathâ†’ fe (mk-cocone p q filler) (mk-cocone p q filler')
             refl refl h = ap (mk-cocone p q)
                           (WithFunExtÏ‰.funextâ†’ fe
                             ((~âˆ™-reflr _ ~â»Â¹) ~âˆ™ h))
}
% ```
}

\p{We can dualize the above constructions to obtain:}

\subtree[stt-0039]{
\taxon{definition}
\meta{defines}{\startverb ["Cospan", "Cospan.Centre",
                           "Cospan.left", "Cospan.right", "mk-cospan"] \stopverb}
\title{Cospans}

\p{A cospan is a diagram of types: #{C \xrightarrow{f} A \xleftarrow{g} B}.}

% ```agda
\agda{
record Cospan ğ“¤ ğ“¥ ğ“¦ : Type (lsuc (ğ“¤ âŠ” ğ“¥ âŠ” ğ“¦)) where
  constructor mk-cospan
  field
    Centre : Type ğ“¤
    {Left} : Type ğ“¥
    left   : Left â†’ Centre
    {Right} : Type ğ“¦
    right : Right â†’ Centre
}
% ```
}


\subtree[stt-003A]{
 \taxon{definition}
 \title{cone}
 \meta{defines}{\startverb ["Cone", "Cone.j",
                            "Cone.i", "Cone.filler",
                            "mk-cone"] \stopverb}
 \p{
  Given a cospan #{s : C \xrightarrow{f} A \xleftarrow{g} B},
  and a type #{Q}, we define the type of #{Q}-cones over #{s} to be the
  structure with:
   \ul{
     \li{A function #{i : Q \to C}}
     \li{A function #{j : Q \to B}}
     \li{A path #{f \circ i = g \circ j}}
   }
 }


% ```agda
\agda{
record Cone  {ğ“¤ ğ“¥ ğ“¦} (S : Cospan ğ“¤ ğ“¥ ğ“¦) {ğ“›} (Carrier : Type ğ“›)
        : Type (lsuc (ğ“¤ âŠ” ğ“¥ âŠ” ğ“¦ âŠ” ğ“›))  where
  constructor mk-cone
  open Cospan S
  field
    i       : Carrier â†’ Left 
    j       : Carrier â†’ Right
    filler  : left âˆ˜ i ~ right âˆ˜ j
}
% ```
}


\subtree[stt-003B]{
\title{Squares is squares}
\taxon{theorem}
\meta{defines}{\startverb ["Coconeâ†Cone", "Coneâ†Cocone"] \stopverb}

\p{When packaged together, a span with a cocone and a cospan with a cospan
  both give the data of a commutative square}

% ```agda
\agda{
Coconeâ†Cone : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“›} 
              â†’ Î£[ S âˆ¶ Cospan ğ“¤ ğ“¥ ğ“¦ ] Î£[ Q âˆ¶ Type ğ“› ] Cone S Q
              â†’ Î£[ S âˆ¶ Span ğ“› ğ“¥ ğ“¦ ] Î£[ A âˆ¶ Type ğ“¤ ] Cocone S A
Coconeâ†Cone (mk-cospan Centre left right , Q , mk-cone i j filler)
  = (mk-span Q i j) , Centre , mk-cocone left right filler

Coneâ†Cocone : âˆ€ {ğ“¤ ğ“¥ ğ“¦ ğ“›}
              â†’ Î£[ S âˆ¶ Span ğ“› ğ“¥ ğ“¦ ] Î£[ A âˆ¶ Type ğ“¤ ] Cocone S A
              â†’ Î£[ S âˆ¶ Cospan ğ“¤ ğ“¥ ğ“¦ ] Î£[ Q âˆ¶ Type ğ“› ] Cone S Q
Coneâ†Cocone (mk-span Centre left right , Q , mk-cocone p q filler)
  = (mk-cospan Q p q) , Centre , (mk-cone left right filler)
}
% ```
}
