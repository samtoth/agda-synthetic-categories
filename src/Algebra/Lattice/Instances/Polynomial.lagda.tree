\title{Polynomials over distributive lattices}
\taxon{Module}
\author{samueltoth}
\date{2025-10-24}
\import{stt-macros}

%```agda
\agda{
module Algebra.Lattice.Instances.Polynomial where

open import Foundations.Prelude
open import ufAxioms

open import Algebra.Lattice
open import Algebra.Poset
open import Modalities.Instances.Truncation

open import Ergonomics.Marker
open import Ergonomics.Auto
open import Ergonomics.Representation

open import Core.CoSlice
open import Data.Bool

}
%```

\subtree[stt-00A5]{
\title{Idea}

\p{We use our intuition for rings to define the free algebras of distributive
lattices as the polynomials. For a first approximation then, we  write a polynomial
as a sequence of terms (where #{x^n} is the n-fold meet of x):}

##{
a_n \land x^n \lor a_{n-1}\land x^{n-1} \lor ... \lor a_0
}

\p{In this setting we have idempotence of meet and join, so all terms #{a_n x^n} with
#{n \ge 2} reduce to #{a_n \land x}.}

\p{Finally, we note that for any #{x,a,b} in the lattice,
##{a \land x \lor b = (a \lor b) \land x \lor b} With these two observations,
we can now see that polynomials in one variable (#{x}) can be represented
uniquely as #{a \land x \lor b} with #{a \ge b}. }
}

\subtree[stt-009X]{
\taxon{Definition}
\title{The 2-simplex}

\p{We give a geometrically-suggestive name to the underlying set of the [free
distributive lattice algebra](stt-009W)}

%```agda
\agda{

record Î”Â² {ğ“¤} {A : Type ğ“¤} (L : Lattice A) : Type ğ“¤ where
  constructor _,_
  open Lattice L
  field
    s t : A
    â¦ƒ mono â¦„ : t â‰¤ s

module _ {ğ“¤} {A : Type ğ“¤} {L : Lattice A} where
  open Lattice L

  unquoteDecl Î”Â²-reprâ‰… Î”Â²-reprâ‰ƒ = make-record-repr Î”Â²-reprâ‰… Î”Â²-reprâ‰ƒ (quote Î”Â²)

  Î”Â²-is-set : is-truncated 2 (Î”Â² L)
  Î”Â²-is-set = Trunc.is-truncatedâ†equiv (Î”Â²-reprâ‰ƒ eâ»Â¹)
                 (Trunc.Î£-is-truncated
                   car-is-set
                   Î» a â†’ Trunc.Î£-is-truncated
                          car-is-set
                            Î» b â†’ suc-is-truncated _ (car-is-set _ _))

  opaque
    Î”Â²-ext : âˆ€ {a b : Î”Â² L} â†’ ((a .Î”Â².s ï¼ b .Î”Â².s) Ã— (a .Î”Â².t ï¼ b .Î”Â².t)) â†’ a ï¼ b
    Î”Â²-ext {x@((a , b) â¦ƒ m â¦„)} {y@(a , b)} (refl , refl)
      = unap-equiv (Î”Â²-reprâ‰ƒ ._â‰ƒ_.has-is-eqv)
         (Î£-pathâ†’ (refl
                  , (Î£-pathâ†’ (refl
                  , (((unlift (car-is-set _ _ _ _)) .centre))))))

  Î”Â²-ext-is-equiv : âˆ€ {a b : Î”Â² L} â†’ is-equiv (Î”Â²-ext {a} {b})
  Î”Â²-ext-is-equiv = is-equivâ†inverse
                      (is-prop-Î£ (is-prop-separated _ _) Î» _ â†’ is-prop-separated _ _)
                      (is-propâ†is-truncated (Î”Â²-is-set _ _))
                      Î» where refl â†’ (refl , refl)

  Î”Â²-refl : âˆ€ {i j : A} { p q : j â‰¤ i } â†’ Id (Î”Â² L) ((i , j) â¦ƒ p â¦„) ((i , j) â¦ƒ q â¦„)
  Î”Â²-refl = Î”Â²-ext (refl , refl)

  opaque
    Î”Â²-ext-ap-s : âˆ€ {a b : Î”Â² L} (p : a .Î”Â².s ï¼ b .Î”Â².s) (q : a .Î”Â².t ï¼ b .Î”Â².t)
                  â†’ ap Î”Â².s (Î”Â²-ext {a = a} {b = b} (p , q)) ï¼ p
    Î”Â²-ext-ap-s {a} {b} refl refl = unlift (car-is-set _ _ _ _) .centre
                                  âˆ™ ap (ap (Î”Â².s) {a = a})
                                       (is-equiv.Îµ Î”Â²-ext-is-equiv refl)

    Î”Â²-ext-ap-t : âˆ€ {a b : Î”Â² L} (p : a .Î”Â².s ï¼ b .Î”Â².s) (q : a .Î”Â².t ï¼ b .Î”Â².t)
                  â†’ ap Î”Â².t (Î”Â²-ext {a = a} {b = b} (p , q)) ï¼ q
    Î”Â²-ext-ap-t {a} {b} refl refl = unlift (car-is-set _ _ _ _) .centre
                                  âˆ™ ap (ap (Î”Â².t) {a = a})
                                       (is-equiv.Îµ Î”Â²-ext-is-equiv refl)
}
%```
}


\subtree[stt-009W]{
\title{The algbera of polynomials over a distributive lattice}
\taxon{Construction}

\p{Fixing a lattice #{L}, we now construct the free [distributive](stt-00A3)
[lattice](stt-009T) [algebra](stt-009Z) over #{L} in one variable, denoted
#{L[x]}.}


%```agda
\agda{
module _ {ğ“¤} {A : Type ğ“¤} (L : Lattice A) (distr : is-distributive L) where
  open Lattice L
  open is-distributive distr
}
%```

\subtree{
\taxon{Notation}

\p{In this construction we will write meet (#{\land}) by juxtaposition.}
}

\p{The lattice structure #{L[x]} on [#{\Delta^2}](stt-009X) has:}

\ul{
\li{#{0 = 0x \lor 0}}
\li{#{1 = 1x \lor 1}}
\li{#{(ax \lor b) \lor (cx \lor d) = (a \lor c)x \lor (b \lor d)}}
\li{#{(ax \lor b) \land (cx \lor d) = ((bc \lor ad \lor ac)x \lor (bd))}}
}

%```agda
\agda{
  L[x] : Lattice (Î”Â² L) -- a âˆ§ x âˆ¨ b âˆˆ L[x]
  L[x] .Lattice.0l = (0l , 0l)
  L[x] .Lattice.1l = (1l , 1l)
  L[x] .Lattice._âˆ¨_ (aâ‚€ , aâ‚) (bâ‚€ , bâ‚)
    = (aâ‚€ âˆ¨ bâ‚€ , aâ‚ âˆ¨ bâ‚)
  L[x] .Lattice._âˆ§_ (aâ‚€ , aâ‚) (bâ‚€ , bâ‚)
    = ((aâ‚€ âˆ§ bâ‚) âˆ¨ (aâ‚ âˆ§ bâ‚€) âˆ¨ (aâ‚€ âˆ§ bâ‚€), aâ‚ âˆ§ bâ‚) â¦ƒ âˆ¨-â‰¤-introl auto! â¦„
  L[x] .Lattice.str-is-lattice = l where
}
%```

\p{Showing that these operations form a lattice follows from some slightly
tedious algebra:}

\details{
%```agda
\agda{
    opaque
      lemma1 : âˆ€ {aâ‚€ aâ‚ : A} â¦ƒ p : aâ‚ â‰¤ aâ‚€ â¦„ â†’
               (aâ‚€ âˆ§ 1l) âˆ¨
               (aâ‚ âˆ§ 1l) âˆ¨ (aâ‚€ âˆ§ 1l)
               ï¼ aâ‚€
      lemma1 {aâ‚€} {aâ‚}
        = ((aâ‚€ âˆ§ 1l) âˆ¨ (aâ‚ âˆ§ 1l) âˆ¨ (aâ‚€ âˆ§ 1l))
            ï¼âŸ¨ apâ‚‚ _âˆ¨_ 1-top (apâ‚‚ _âˆ¨_ 1-top 1-top) âŸ©
          aâ‚€ âˆ¨ aâ‚ âˆ¨ aâ‚€
            ï¼âŸ¨ âˆ¨-assoc âˆ™ âˆ¨-comm âˆ™ âˆ¨-assoc âˆ™ ap (_âˆ¨ aâ‚) âˆ¨-idem âŸ©
          aâ‚€ âˆ¨ aâ‚
            ï¼âŸ¨ âˆ¨-comm âˆ™ â‰¤-max auto! âŸ©
          aâ‚€ âˆ

      lemma2 : âˆ€ {aâ‚€ aâ‚ bâ‚€ bâ‚} â¦ƒ p : aâ‚€ â‰¤ aâ‚ â¦„ â¦ƒ q : bâ‚€ â‰¤ bâ‚ â¦„
               â†’ aâ‚ âˆ¨ (aâ‚ âˆ§ bâ‚€) âˆ¨ (aâ‚€ âˆ§ bâ‚) âˆ¨ (aâ‚ âˆ§ bâ‚) ï¼ aâ‚
      lemma2 {aâ‚€} {aâ‚} {bâ‚€} {bâ‚} â¦ƒ p â¦„
        = (aâ‚ âˆ¨ aâ‚ âˆ§ bâ‚€ âˆ¨ aâ‚€ âˆ§ bâ‚ âˆ¨ aâ‚ âˆ§ bâ‚) ï¼âŸ¨ âˆ¨-assoc âˆ™ apâ‚‚ _âˆ¨_ âˆ¨-âˆ§-abs refl âŸ©
          (aâ‚ âˆ¨ aâ‚€ âˆ§ bâ‚ âˆ¨ aâ‚ âˆ§ bâ‚)           ï¼âŸ¨ âˆ¨-assoc âˆ™ âˆ¨-comm âˆ™ âˆ¨-assoc
                                               âˆ™ apâ‚‚ _âˆ¨_ (âˆ¨-comm âˆ™ âˆ¨-âˆ§-abs) refl âŸ©
          (aâ‚ âˆ¨ aâ‚€ âˆ§ bâ‚)                     ï¼âŸ¨ distrib-âˆ¨-âˆ§ âŸ©
          ((aâ‚ âˆ¨ aâ‚€) âˆ§ (aâ‚ âˆ¨ bâ‚))            ï¼âŸ¨ ap (_âˆ§ (aâ‚ âˆ¨ bâ‚))
                                                    (âˆ¨-comm âˆ™ â‰¤-max p) âŸ©
          aâ‚ âˆ§ (aâ‚ âˆ¨ bâ‚)                     ï¼âŸ¨ âˆ§-âˆ¨-abs âŸ©
          aâ‚    âˆ

      lemma3 : âˆ€ {aâ‚€ aâ‚ bâ‚€ bâ‚} â¦ƒ m : aâ‚€ â‰¤ aâ‚ â¦„ â¦ƒ n : bâ‚€ â‰¤ bâ‚ â¦„
               â†’ aâ‚ âˆ§ (aâ‚€ âˆ¨ bâ‚€) âˆ¨ aâ‚€ âˆ§ (aâ‚ âˆ¨ bâ‚) âˆ¨ aâ‚ âˆ§ (aâ‚ âˆ¨ bâ‚) ï¼ aâ‚
      lemma3 {aâ‚€} {aâ‚} {bâ‚€} {bâ‚} â¦ƒ m â¦„ â¦ƒ n â¦„
        = (aâ‚ âˆ§ (aâ‚€ âˆ¨ bâ‚€) âˆ¨ aâ‚€ âˆ§ (aâ‚ âˆ¨ bâ‚) âˆ¨ aâ‚ âˆ§ (aâ‚ âˆ¨ bâ‚))
            ï¼âŸ¨ apâ‚‚ _âˆ¨_ refl (apâ‚‚ _âˆ¨_ (âˆ¨-â‰¤-introl m) âˆ§-âˆ¨-abs) âŸ©
          ((aâ‚ âˆ§ (aâ‚€ âˆ¨ bâ‚€)) âˆ¨ aâ‚€ âˆ¨ aâ‚)
            ï¼âŸ¨ apâ‚‚ _âˆ¨_ distrib-âˆ§-âˆ¨ (â‰¤-max m) âŸ©
          ((aâ‚ âˆ§ aâ‚€ âˆ¨ aâ‚ âˆ§ bâ‚€) âˆ¨ aâ‚)
            ï¼âŸ¨ sym âˆ¨-assoc âˆ™ ap (_ âˆ¨_) (âˆ¨-comm âˆ™ âˆ¨-âˆ§-abs) âŸ©
          (aâ‚ âˆ§ aâ‚€ âˆ¨ aâ‚)
            ï¼âŸ¨ ap (_âˆ¨ aâ‚) (âˆ§-comm âˆ™ m) âˆ™ â‰¤-max m âŸ©
          aâ‚ âˆ

      lemma-assoc : âˆ€ {a b c d e f}
                    â†’ a âˆ§ d âˆ§ f âˆ¨
                      b âˆ§ (c âˆ§ f âˆ¨ d âˆ§ e âˆ¨ c âˆ§ e) âˆ¨ a âˆ§ (c âˆ§ f âˆ¨ d âˆ§ e âˆ¨ c âˆ§ e)
                    ï¼
                        (a âˆ§ d âˆ¨ b âˆ§ c âˆ¨ a âˆ§ c) âˆ§ f
                      âˆ¨ (b âˆ§ d) âˆ§ e
                      âˆ¨ (a âˆ§ d âˆ¨ b âˆ§ c âˆ¨ a âˆ§ c) âˆ§ e
      lemma-assoc {a} {b} {c} {d} {e} {f}
        = (a âˆ§ d âˆ§ f âˆ¨
           b âˆ§ (c âˆ§ f âˆ¨ d âˆ§ e âˆ¨ c âˆ§ e) âˆ¨ a âˆ§ (c âˆ§ f âˆ¨ d âˆ§ e âˆ¨ c âˆ§ e))
             ï¼âŸ¨ ap (a âˆ§ d âˆ§ f âˆ¨_)
                  (apâ‚‚ _âˆ¨_ distribâ‚‚-âˆ§-âˆ¨ distribâ‚‚-âˆ§-âˆ¨) âŸ©
           (a âˆ§ d âˆ§ f âˆ¨ ((b âˆ§ c âˆ§ f) âˆ¨ (b âˆ§ d âˆ§ e) âˆ¨ (b âˆ§ c âˆ§ e))
             âˆ¨ ((a âˆ§ c âˆ§ f) âˆ¨ (a âˆ§ d âˆ§ e) âˆ¨ a âˆ§ c âˆ§ e))
             ï¼âŸ¨ ap (_ âˆ¨_) (sym âˆ¨-assoc âˆ™ ap (_ âˆ¨_) (âˆ¨-assoc
                                                    âˆ™ ap (_âˆ¨ (a âˆ§ d âˆ§ e âˆ¨ a âˆ§ c âˆ§ e))
                                                         âˆ¨-comm
                                                    âˆ™ sym âˆ¨-assoc))
               âˆ™ âˆ¨-assoc âˆ™ âˆ¨-assoc
               âˆ™ apâ‚‚ _âˆ¨_ (sym âˆ¨-assoc âˆ™ apâ‚ƒ (Î» x y z â†’ x âˆ¨ (y âˆ¨ z)) âˆ§-assoc âˆ§-assoc âˆ§-assoc)
                         (apâ‚‚ _âˆ¨_ (apâ‚‚ _âˆ¨_ âˆ§-assoc âˆ§-assoc)
                                  (apâ‚‚ _âˆ¨_ âˆ§-assoc âˆ§-assoc)
                         âˆ™ sym âˆ¨-assoc âˆ™ ap ((b âˆ§ d) âˆ§ e âˆ¨_)
                                            (âˆ¨-assoc
                                            âˆ™ ap (_âˆ¨ (a âˆ§ c) âˆ§ e) âˆ¨-comm
                                            âˆ™ sym âˆ¨-assoc)) âŸ©
           (((a âˆ§ d) âˆ§ f âˆ¨ (b âˆ§ c) âˆ§ f âˆ¨ (a âˆ§ c) âˆ§ f) âˆ¨
            (b âˆ§ d) âˆ§ e âˆ¨ (a âˆ§ d) âˆ§ e âˆ¨ (b âˆ§ c) âˆ§ e âˆ¨ (a âˆ§ c) âˆ§ e)
             ï¼âŸ¨ sym (apâ‚ƒ (Î» x y z â†’ x âˆ¨ (y âˆ¨ z)) distribâ‚‚-âˆ§-âˆ¨' refl distribâ‚‚-âˆ§-âˆ¨') âŸ©
           ((a âˆ§ d âˆ¨ b âˆ§ c âˆ¨ a âˆ§ c) âˆ§ f
            âˆ¨ (b âˆ§ d) âˆ§ e
            âˆ¨ (a âˆ§ d âˆ¨ b âˆ§ c âˆ¨ a âˆ§ c) âˆ§ e)    âˆ

    l : is-lattice (Lattice.0l L[x]) (Lattice.1l L[x])
                   (Lattice._âˆ§_ L[x]) (Lattice._âˆ¨_ L[x])
    l .is-lattice.car-is-set = Î”Â²-is-set
    l .is-lattice.âˆ§-assoc {a , b} {c , d} {e , f}
      = Î”Â²-ext (lemma-assoc , âˆ§-assoc)
    l .is-lattice.âˆ¨-assoc
      = Î”Â²-ext (âˆ¨-assoc , âˆ¨-assoc)
    l .is-lattice.âˆ§-comm {(aâ‚€ , aâ‚) â¦ƒ m â¦„} {(bâ‚€ , bâ‚) â¦ƒ n â¦„}
      = Î”Â²-ext (apâ‚‚ _âˆ¨_ âˆ§-comm (apâ‚‚ _âˆ¨_ âˆ§-comm âˆ§-comm)
                       âˆ™ âˆ¨-assoc âˆ™ ap (_âˆ¨ bâ‚€ âˆ§ aâ‚€) âˆ¨-comm âˆ™ sym âˆ¨-assoc
               , âˆ§-comm)
    l .is-lattice.âˆ¨-comm
      = Î”Â²-ext (âˆ¨-comm , âˆ¨-comm)
    l .is-lattice.âˆ¨-âˆ§-abs {(aâ‚€ , aâ‚) â¦ƒ m â¦„} {(bâ‚€ , bâ‚) â¦ƒ n â¦„}
      = Î”Â²-ext (lemma2 , âˆ¨-âˆ§-abs)
    l .is-lattice.âˆ§-âˆ¨-abs {(aâ‚€ , aâ‚) â¦ƒ m â¦„} {(bâ‚€ , bâ‚) â¦ƒ n â¦„}
      = Î”Â²-ext (lemma3 , âˆ§-âˆ¨-abs)
    l .is-lattice.0-bottom
      = Î”Â²-ext (0-bottom , 0-bottom)
    l .is-lattice.1-top {(aâ‚€ , aâ‚) â¦ƒ m â¦„}
      = Î”Â²-ext (lemma1 , auto!)
}
%```
}

\subtree[stt-00A6]{
\taxon{Lemma}
\title{#{L[x]} is an #{L}-algebra}

\p{The inclusion #{\iota : L \to L[x]} that takes an #{a : L} to #{ax \lor a}
exhibits #{L[x]} as an #{L}-algebra.}

\p{The only part of the proof which does not hold definitionally is showing:
##{\iota(x) \land \iota(y) = \iota(x \land y)}

Extensionality for the 2-simplex says that we can just compare coefficients. The
constant terms are definitionally equal, for the linear terms we need:
#{xy \lor yy \lox xy = xy}, but this follows from the idempotence and
commutativity of #{\lor}.}

%```agda
\agda{
  Î¹-const : A â†’ Î”Â² L
  Î¹-const x = (x , x)

  L[x]-is-lattice-algebra : is-lattice-hom L L[x] Î¹-const
  L[x]-is-lattice-algebra .is-lattice-hom.pres-âˆ¨
    = Î”Â²-ext (refl , refl)
  L[x]-is-lattice-algebra .is-lattice-hom.pres-âˆ§
    = Î”Â²-ext (sym (ap ((_ âˆ§ _) âˆ¨_)âˆ¨-idem âˆ™ âˆ¨-idem) , refl)
  L[x]-is-lattice-algebra .is-lattice-hom.pres-0
    = Î”Â²-ext (refl , refl)
  L[x]-is-lattice-algebra .is-lattice-hom.pres-1
    = Î”Â²-ext (refl , refl)
}
%```
}
}

\subtree[stt-00A7]{
\taxon{Theorem}
\title{[#{L[x]}](stt-009W) is the free #{L}-algebra on 1 generator}

\p{Let #{M} be some other #{L}-algebra. For each #{m : M}, there is an evident
map #{L[x] \to M} given by #{(ax \lor b) \mapsto \iota(a)m \lor \iota(b)};
we show this map is a [morphism of lattice algebras](stt-009Z).}

%```agda
\agda{
  eval-polynomial : âˆ€ {ğ“¤} {B : Type ğ“¤} (M : Lattice B) {i : A â†’ B}
                    â†’ is-lattice-algebra L M i
                    â†’ B â†’ Coslice-map Î¹-const i
  eval-polynomial M {i} ialg x .fst (aâ‚€ , aâ‚) = (i aâ‚€ M.âˆ§ x) M.âˆ¨ i aâ‚
    where module M = Lattice M
  eval-polynomial M {i} ialg b .snd a = M.âˆ¨-comm âˆ™ M.âˆ¨-âˆ§-abs where
    module M = Lattice M

  eval-polynomial-is-alg-hom
    : âˆ€ {ğ“¤} {B : Type ğ“¤} (M : Lattice B) (M-distr : is-distributive M) {i : A â†’ B}
    â†’ (ialg : is-lattice-algebra L M i)
    â†’ (b : B)
    â†’ is-lattice-alg-hom L L[x] L[x]-is-lattice-algebra
                           M ialg
                           (eval-polynomial M ialg b)
  eval-polynomial-is-alg-hom M Md {i} ialg x
    = l where
    module M = Lattice M
    open is-lattice-hom
    module Md = is-distributive  Md

    l : is-lattice-alg-hom L L[x] L[x]-is-lattice-algebra
                             M ialg
                             (eval-polynomial M ialg x)
    l .pres-0 = M.âˆ¨-comm âˆ™ M.âˆ¨-âˆ§-abs âˆ™ ialg .pres-0
    l .pres-1 = M.âˆ¨-comm âˆ™ M.âˆ¨-âˆ§-abs âˆ™ ialg .pres-1
    l .pres-âˆ¨ {(aâ‚€ , aâ‚)} {(bâ‚€ , bâ‚)}
      = (âŒœ i (aâ‚€ âˆ¨ bâ‚€)âŒ M.âˆ§ x M.âˆ¨ i (aâ‚ âˆ¨ bâ‚))
         ï¼âŸ¨ apâ‚‚ M._âˆ¨_ (ap! (ialg .pres-âˆ¨) âˆ™ Md.distrib-âˆ§-âˆ¨') (ialg .pres-âˆ¨) âŸ©
        ((i aâ‚€ M.âˆ§ x M.âˆ¨ i bâ‚€ M.âˆ§ x) M.âˆ¨ i aâ‚ M.âˆ¨ i bâ‚)
          ï¼âŸ¨ sym M.âˆ¨-assoc âŸ©
        (i aâ‚€ M.âˆ§ x M.âˆ¨ âŒœ i bâ‚€ M.âˆ§ x M.âˆ¨ i aâ‚ M.âˆ¨ i bâ‚ âŒ)
          ï¼âŸ¨ ap! (M.âˆ¨-assoc âˆ™ apâ‚‚ M._âˆ¨_ M.âˆ¨-comm refl âˆ™ sym M.âˆ¨-assoc)
            âˆ™ M.âˆ¨-assoc âŸ©
        ((i aâ‚€ M.âˆ§ x M.âˆ¨ i aâ‚) M.âˆ¨ i bâ‚€ M.âˆ§ x M.âˆ¨ i bâ‚) âˆ
    l .pres-âˆ§ {(aâ‚€ , aâ‚)} {(bâ‚€ , bâ‚)}
      = sym (Md.polynomial-mult' x
            âˆ™ apâ‚‚ M._âˆ¨_ (ap (M._âˆ§ x)
                            (sym (ialg .pres-âˆ¨
                              âˆ™ apâ‚‚ M._âˆ¨_ (ialg .pres-âˆ§)
                                          (ialg .pres-âˆ¨
                                          âˆ™ apâ‚‚ M._âˆ¨_ (ialg .pres-âˆ§)
                                                      (ialg .pres-âˆ§)))))
                        (sym (ialg .pres-âˆ§)))
}
%```

\p{We exhibit #{L[x]} as the initial algebra by showing that every
morphism of algebras arises this way. Or more formally, that the bundled map
from elements of #{M} to algebra morphisms #{L[x] \to M} is an equivalence.}

%```agda
\agda{
  L[x]-ev-algebra-hom
    : âˆ€ {ğ“¤} {B : Type ğ“¤} {M : Lattice B} (Md : is-distributive M)
        {i : A â†’ B} (ialg : is-lattice-algebra L M i)
      â†’ B â†’ Î£ _ (is-lattice-alg-hom L L[x] L[x]-is-lattice-algebra M ialg)
  L[x]-ev-algebra-hom Md ialg b
    = (eval-polynomial _ ialg b , eval-polynomial-is-alg-hom _ Md ialg b)

  L[x]-is-free-algebra
    : âˆ€ {ğ“¤} {B : Type ğ“¤} {M : Lattice B} (Md : is-distributive M) {i : A â†’ B}
      â†’ (ialg : is-lattice-algebra L M i)
      â†’ is-equiv (L[x]-ev-algebra-hom Md ialg)
  L[x]-is-free-algebra {M = M} Md {i} ialg = is-equivâ†qiso qiso where
    module M = Lattice M
    module L[x] = Lattice L[x]
    open is-lattice-hom

    qiso : quasi-iso (L[x]-ev-algebra-hom Md ialg)
    qiso .fst (map , ishom) = map .fst (1l , 0l) -- f â†¦ f(1)
    qiso .snd .fst b = ap ((i 1l M.âˆ§ _) M.âˆ¨_) (ialg .pres-0)
                     âˆ™ M.0-bottom âˆ™ M.âˆ§-comm âˆ™ ap (b M.âˆ§_) (ialg .pres-1)
                     âˆ™ M.1-top
    qiso .snd .snd ((f , K) , isalghom)
      = Î£-pathâ†’ (Î£-pathâ†’ (funextâ†’ H
              , funextâ†’ (Î» _ â†’ M.is-prop-separated _ _ _ _))
              , (is-lattice-hom-is-prop L[x] M f _ _)) where
      H : ((a , b) : Î”Â² L) â†’
           i a M.âˆ§ f (1l , 0l) M.âˆ¨ i b ï¼ f (a , b)
      H ((a , b) â¦ƒ p â¦„)
        = (i a M.âˆ§ f (1l , 0l) M.âˆ¨ i b)
             ï¼âŸ¨ apâ‚‚ M._âˆ¨_ (ap (M._âˆ§ _) (sym (K a))) (sym (K b)) âŸ©
          f (a , a) M.âˆ§ f (1l , 0l) M.âˆ¨ f (b , b)      ï¼âŸ¨ ap (M._âˆ¨ _) (sym (isalghom .pres-âˆ§)) âŸ©
          (f ((a , a) L[x].âˆ§ (1l , 0l)) M.âˆ¨ f (b , b)) ï¼âŸ¨âŸ©
          (f (((a âˆ§ 0l âˆ¨ a âˆ§ 1l âˆ¨ a âˆ§ 1l) , (a âˆ§ 0l)) â¦ƒ _ â¦„) M.âˆ¨ f (b , b))
             ï¼âŸ¨ ap (Î» x â†’ f x M.âˆ¨ f (b , b))
                    (Î”Â²-ext (ap (_ âˆ¨_) âˆ¨-idem âˆ™ sym distrib-âˆ§-âˆ¨
                            âˆ™ ap (a âˆ§_) (âˆ¨-comm âˆ™ 0-bottom) âˆ™ auto!
                            , (âˆ§-comm âˆ™ 0-init))) âŸ©
          (f (a , 0l) M.âˆ¨ f (b , b))                   ï¼âŸ¨ sym (isalghom .pres-âˆ¨) âŸ©
          (f ((a , 0l) L[x].âˆ¨ (b , b))) ï¼âŸ¨âŸ©
          f ((a âˆ¨ b) , (0l âˆ¨ b))
            ï¼âŸ¨ ap f (Î”Â²-ext ((âˆ¨-comm âˆ™ â‰¤-max p) , âˆ¨-comm âˆ™ 0-bottom)) âŸ©
          f (a , b) âˆ
}
%```
}
