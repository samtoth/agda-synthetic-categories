\title{Squares}
\taxon{Module}
\author{samueltoth}
\import{stt-macros}

% ```agda
\agda{
module Foundations.Square where

open import Foundations.Universes
open import Foundations.Functions
open import Foundations.Identity
open import Foundations.DependentIdentity
open import Foundations.Homotopy

opaque
  Square : âˆ€ {ğ“¤} {A : Type ğ“¤}
           â†’ {a00 a01 a10 a11 : A}
           â†’ (ai0 : a00 ï¼ a10)
           â†’ (ai1 : a01 ï¼ a11)
           â†’ (a0i : a00 ï¼ a01)
           â†’ (a1i : a10 ï¼ a11)
           â†’ Type ğ“¤
  Square {a00 = a00} {a01} {a10} {a11}
         ai0 ai1 a0i a1i = ai0 âˆ™ a1i ï¼ a0i âˆ™ ai1
         -- IdP (apâ‚‚ (_ï¼_) ai0 ai1) a0i a1i

  Square-reflect-hor
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      â†’ {a00 a01 a10 a11 : A}
      â†’ (ai0 : a00 ï¼ a10)
      â†’ (ai1 : a01 ï¼ a11)
      â†’ (a0i : a00 ï¼ a01)
      â†’ (a1i : a10 ï¼ a11)
      â†’ Square ai0 ai1 a0i a1i â†’ Square ai1 ai0 (sym a0i) (sym a1i)
  Square-reflect-hor i0 refl refl refl p = sym p âˆ™ âˆ™-reflr _

  Square-reflect-vert
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      â†’ {a00 a01 a10 a11 : A}
      â†’ (ai0 : a00 ï¼ a10)
      â†’ (ai1 : a01 ï¼ a11)
      â†’ (a0i : a00 ï¼ a01)
      â†’ (a1i : a10 ï¼ a11)
      â†’ Square ai0 ai1 a0i a1i â†’ Square (sym ai0) (sym ai1) a1i a0i
  Square-reflect-vert refl ai1 refl refl x = ap sym x

  Square-functorial-top
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
        {a00 a01 a10 a11 : A}
      â†’ {ai0 ai0' : a00 ï¼ a10}
      â†’ ai0 ï¼ ai0'
      â†’ {ai1 : a01 ï¼ a11}
      â†’ {a0i : a00 ï¼ a01}
      â†’ {a1i : a10 ï¼ a11}
      â†’ Square ai0 ai1 a0i a1i ï¼ Square ai0' ai1 a0i a1i
  Square-functorial-top refl = refl

  Square-functorial-bot
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
        {a00 a01 a10 a11 : A}
      â†’ {ai0 : a00 ï¼ a10}
      â†’ {ai1 ai1' : a01 ï¼ a11}
      â†’ ai1 ï¼ ai1'
      â†’ {a0i : a00 ï¼ a01}
      â†’ {a1i : a10 ï¼ a11}
      â†’ Square ai0 ai1 a0i a1i ï¼ Square ai0 ai1' a0i a1i
  Square-functorial-bot refl = refl

  Square-squeeze-topr
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      â†’ {a00 a01 a10 a20 a21 : A}
      â†’ {ai0 : a00 ï¼ a10} (a2i0 : a10 ï¼ a20)
      â†’ {ai1 : a01 ï¼ a21}
      â†’ {a0i : a00 ï¼ a01}
      â†’ {a2i : a20 ï¼ a21}
      â†’ Square (ai0 âˆ™ a2i0) ai1 a0i a2i ï¼ Square ai0 ai1 a0i (a2i0 âˆ™ a2i)
  Square-squeeze-topr {ai0 = refl} _ = refl

  Square-squeeze-botr
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      â†’ {a00 a01 a20 a11 a21 : A}
      â†’ {ai0 : a00 ï¼ a20}
      â†’ {ai1 : a01 ï¼ a11}
      â†’ {a2i1 : a11 ï¼ a21} {a2i1' : a21 ï¼ a11} (p : a2i1 ï¼ sym a2i1')
      â†’ {a0i : a00 ï¼ a01}
      â†’ {a2i : a20 ï¼ a21}
      â†’ Square ai0 (ai1 âˆ™ a2i1) a0i a2i ï¼ Square ai0 ai1 a0i (a2i âˆ™ a2i1')
  Square-squeeze-botr {ai1 = refl} {a2i1' = refl} refl {a2i = refl} = refl

  Square-squeeze-botl
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      â†’ {a00 a01 a02 a10 a12 : A}
      â†’ {ai0 : a00 ï¼ a10}
      â†’ {ai2 : a02 ï¼ a12}
      â†’ {a0i : a00 ï¼ a01} (a02i : a01 ï¼ a02)
      â†’ {a2i : a10 ï¼ a12}
      â†’ Square ai0 ai2 (a0i âˆ™ a02i) a2i ï¼ Square ai0 (a02i âˆ™ ai2) a0i a2i
  Square-squeeze-botl {a0i = refl} refl  = refl

  Square-degen-hor : âˆ€ {ğ“¤} {A : Type ğ“¤}
                   â†’ {a b : A}
                   â†’ (p q : a ï¼ b)
                   â†’ (s : p ï¼ q)
                   â†’ Square p q refl refl
  Square-degen-hor p q R = âˆ™-reflr p âˆ™ R


  Square-degen-vert : âˆ€ {ğ“¤} {A : Type ğ“¤}
                   â†’ {a b : A}
                   â†’ (p q : a ï¼ b)
                   â†’ (s : p ï¼ q)
                   â†’ Square refl refl p q
  Square-degen-vert p q R = sym (âˆ™-reflr p âˆ™ R)

  Square-degen-diag : âˆ€ {ğ“¤} {A : Type ğ“¤}
                   â†’ {a b : A}
                   â†’ (p q : a ï¼ b)
                   â†’ (s : p ï¼ q)
                   â†’ Square (sym p) refl refl q
  Square-degen-diag p q refl = âˆ™-sym' p

  Square-flatten-hor
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      â†’ {a0 a1 a2 : A}
      â†’ {ai0 : a1 ï¼ a2}
      â†’ {p   : a0 ï¼ a1}
      â†’ {ai1 : a1 ï¼ a2}
      â†’ (ai0 ï¼ ai1)
      â†’ Square p ai0 p ai1
  Square-flatten-hor {p = p} = ap (p âˆ™_) âˆ˜ sym

  Square-flatten-vert
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      â†’ {a0 a1 a2 : A}
      â†’ {a0i : a2 ï¼ a0}
      â†’ {p   : a0 ï¼ a1}
      â†’ {a1i : a2 ï¼ a0}
      â†’ (a0i ï¼ a1i)
      â†’ Square a1i p a0i p
  Square-flatten-vert {p = refl} = sym âˆ˜ ap (_âˆ™ refl)

  Square-left-whisker
    : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {B : Type ğ“¥} (f : A â†’ B)
      â†’ {a00 a01 a10 a11 : A}
      â†’ {fi0 : f a00 ï¼ f a10} {ai0 : a00 ï¼ a10} (p : fi0 ï¼ ap f ai0)
      â†’ {fi1 : f a01 ï¼ f a11} {ai1 : a01 ï¼ a11} (q : fi1 ï¼ ap f ai1)
      â†’ {f0i : f a00 ï¼ f a01} {a0i : a00 ï¼ a01} (r : f0i ï¼ ap f a0i)
      â†’ {f1i : f a10 ï¼ f a11} {a1i : a10 ï¼ a11} (s : f1i ï¼ ap f a1i)
      â†’ Square ai0 ai1 a0i a1i
      â†’ Square fi0 fi1 f0i f1i
  Square-left-whisker f {ai0 = ai0} refl {_} {ai1} refl
                        {_} {a0i} refl {_} {a1i} refl p
    = sym (ap-âˆ™ f ai0 a1i) âˆ™ ap (ap f) p âˆ™ ap-âˆ™ f a0i ai1

  Squareâ†IdP : âˆ€ {ğ“¤} {A : Type ğ“¤}
           â†’ {a00 a01 a10 a11 : A}
           â†’ (ai0 : a00 ï¼ a10)
           â†’ (ai1 : a01 ï¼ a11)
           â†’ (a0i : a00 ï¼ a01)
           â†’ (a1i : a10 ï¼ a11)
           â†’ IdP (apâ‚‚ (_ï¼_) ai0 ai1) a0i a1i
           â†’ Square ai0 ai1 a0i a1i
  Squareâ†IdP refl refl refl a1i p = sym p


  IdPâ†Square :  âˆ€ {ğ“¤} {A : Type ğ“¤}
           â†’ {a00 a01 a10 a11 : A}
           â†’ (ai0 : a00 ï¼ a10)
           â†’ (ai1 : a01 ï¼ a11)
           â†’ (a0i : a00 ï¼ a01)
           â†’ (a1i : a10 ï¼ a11)
           â†’ Square ai0 ai1 a0i a1i
           â†’ IdP (apâ‚‚ (_ï¼_) ai0 ai1) a0i a1i
  IdPâ†Square refl refl refl a1i p = sym p

  Squareâ†IdP-func : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {B : Type ğ“¥}
                    â†’ {a0 a1 : A}
                    â†’ {f g : A â†’ B}
                    â†’ (p : a0 ï¼ a1)
                    â†’ (q : f a0 ï¼ g a0)
                    â†’ (r : f a1 ï¼ g a1)
                    â†’ IdP (ap (Î» x â†’ f x ï¼ g x) p) q r
                    â†’ Square (ap f p) (ap g p) q r
  Squareâ†IdP-func refl p q r = sym (âˆ™-reflr _ âˆ™ r)

  IdP-funcâ†Square : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {B : Type ğ“¥}
                    â†’ {a0 a1 : A}
                    â†’ {f g : A â†’ B}
                    â†’ (p : a0 ï¼ a1)
                    â†’ (q : f a0 ï¼ g a0)
                    â†’ (r : f a1 ï¼ g a1)
                    â†’ Square (ap f p) (ap g p) q r
                    â†’ IdP (ap (Î» x â†’ f x ï¼ g x) p) q r
  IdP-funcâ†Square refl p q r = sym (r âˆ™ âˆ™-reflr _)


  IdP-Î â†Square : âˆ€ {ğ“¤ ğ“¥} {A : Type ğ“¤} {B : A â†’ Type ğ“¥}
                    â†’ {a0 a1 : A}
                    â†’ {f g : Î  A B}
                    â†’ (p : a0 ï¼ a1)
                    â†’ {q : f a0 ï¼ g a0}
                    â†’ {r : f a1 ï¼ g a1}
                    â†’ Square (apáµˆ f p) (apáµˆ g p) (ap (tr B p) q) r
                    â†’ IdP (ap (Î» x â†’ f x ï¼ g x) p) q r
  IdP-Î â†Square refl r = sym (r âˆ™ âˆ™-reflr _ âˆ™ ap-id _)

  Squareâ†brtï¼l : âˆ€ {ğ“¤} {A : Type ğ“¤}
           â†’ {a00 a01 a10 a11 : A}
           â†’ (ai0 : a00 ï¼ a10)
           â†’ {ai1 : a01 ï¼ a11}
           â†’ {a0i : a00 ï¼ a01}
           â†’ {a1i : a10 ï¼ a11}
           â†’ ai0 âˆ™ a1i âˆ™ sym ai1 ï¼ a0i
           â†’ Square ai0 ai1 a0i a1i
  Squareâ†brtï¼l refl {refl} {refl} p = sym (âˆ™-reflr _) âˆ™ p

  Squareâ†brtï¼l' : âˆ€ {ğ“¤} {A : Type ğ“¤}
           â†’ {a00 a01 a10 a11 : A}
           â†’ (ai0 : a00 ï¼ a10)
           â†’ {ai1 : a11 ï¼ a01}
           â†’ {a0i : a00 ï¼ a01}
           â†’ {a1i : a10 ï¼ a11}
           â†’ ai0 âˆ™ a1i âˆ™ ai1 ï¼ a0i
           â†’ Square ai0 (sym ai1) a0i a1i
  Squareâ†brtï¼l' refl {refl} {refl} p = sym (âˆ™-reflr _) âˆ™ p

  Square-drop-i : âˆ€ {ğ“¤} {A : Type ğ“¤}
                  â†’ {a b : A}
                  â†’ (p : a ï¼ b)
                  â†’ Square p p refl refl
  Square-drop-i refl = refl

  Square-drop-j : âˆ€ {ğ“¤} {A : Type ğ“¤}
                  â†’ {a b : A}
                  â†’ (p : a ï¼ b)
                  â†’ Square refl refl p p
  Square-drop-j refl = refl

  mk-square : âˆ€ {ğ“¤} {A : Type ğ“¤}
           â†’ {a00 a01 a10 a11 : A}
           â†’ {ai0 : a00 ï¼ a10}
           â†’ {ai1 : a01 ï¼ a11}
           â†’ {a0i : a00 ï¼ a01}
           â†’ {a1i : a10 ï¼ a11}
           â†’ ai0 âˆ™ a1i ï¼ a0i âˆ™ ai1
           â†’ Square ai0 ai1 a0i a1i
  mk-square = id

  un-square : âˆ€ {ğ“¤} {A : Type ğ“¤}
           â†’ {a00 a01 a10 a11 : A}
           â†’ {ai0 : a00 ï¼ a10}
           â†’ {ai1 : a01 ï¼ a11}
           â†’ {a0i : a00 ï¼ a01}
           â†’ {a1i : a10 ï¼ a11}
           â†’ Square ai0 ai1 a0i a1i
           â†’ ai0 âˆ™ a1i ï¼ a0i âˆ™ ai1
  un-square = id

  un-mk-square
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      {a00 a01 a10 a11 : A}
      {ai0 : a00 ï¼ a10}
      {ai1 : a01 ï¼ a11}
      {a0i : a00 ï¼ a01}
      {a1i : a10 ï¼ a11}
    â†’ un-square {ai0 = ai0} {ai1} {a0i} {a1i} âˆ˜ mk-square ~ id
  un-mk-square = ~refl

  mk-un-square
    : âˆ€ {ğ“¤} {A : Type ğ“¤}
      {a00 a01 a10 a11 : A}
      {ai0 : a00 ï¼ a10}
      {ai1 : a01 ï¼ a11}
      {a0i : a00 ï¼ a01}
      {a1i : a10 ï¼ a11}
    â†’ mk-squareÂ âˆ˜ un-square {ai0 = ai0} {ai1} {a0i} {a1i}  ~ id
  mk-un-square = ~refl

opaque
  unfolding Square
  SquareP : âˆ€ {ğ“¤} {A B C D : Type ğ“¤}
            {ab : A ï¼ B} {cd : C ï¼ D} {ac : A ï¼ C} {bd : B ï¼ D}
            (S : Square ab cd ac bd)
            {s00 : A} {s10 : B} {s01 : C} {s11 : D}
            â†’ (si0 : IdP ab s00 s10)
            â†’ (si1 : IdP cd s01 s11)
            â†’ (s0i : IdP ac s00 s01)
            â†’ (s1i : IdP bd s10 s11)
            â†’ Type ğ“¤
  SquareP {ab = ab} {cd} {ac} S {s00} {s10} {s01} {s11} si0 si1 s0i s1i
    = IdP (ap (Î» x â†’ coe x s00 ï¼ s11) S) (si0 âˆ™[ ab âˆ™ _ ] s1i) (s0i  âˆ™[ ac âˆ™ cd ] si1)

  drop-i : âˆ€ {ğ“¤} {A B : Type ğ“¤} {P : A ï¼ B} {a : A} {b : B} (p : IdP P a b)
           â†’ SquareP {C = A} {D = B} {P} {P} (Square-degen-hor P P refl) p p refl refl
  drop-i {P = refl} refl = refl

  drop-j : âˆ€ {ğ“¤} {A B : Type ğ“¤} {P : A ï¼ B} {a : A} {b : B} (p : IdP P a b)
           â†’ SquareP {ab = refl} (Square-degen-vert P P refl) refl refl p p
  drop-j {P = refl} refl = refl

record Hexagon {ğ“¤} {A : Type ğ“¤} {a b c d e f : A}
               (ab : a ï¼ b) (bc : b ï¼ c) (cd : c ï¼ d)
               (ae : a ï¼ e) (ef : e ï¼ f) (fd : f ï¼ d) : Type ğ“¤ where
  no-eta-equality
  constructor mk-hex
  field
    un-hex : ab âˆ™ bc âˆ™ cd ï¼ ae âˆ™ ef âˆ™ fd

  Squareâ†hex : Square ab (ef âˆ™ fd) ae (bc âˆ™ cd)
  Squareâ†hex = mk-square un-hex

  Square-compress-bot
    : Square ab (ef âˆ™ fd âˆ™ sym cd) ae bc
  Square-compress-bot
    = tr (Î» p â†’ Square ab p ae bc) (âˆ™-assoc ef fd (sym cd))
        (coe (sym (Square-squeeze-botr refl)) Squareâ†hex)

  Square-bl
    : Square ab (fd âˆ™ sym cd) (ae âˆ™ ef) bc
  Square-bl = coe (sym (Square-squeeze-botl ef)) Square-compress-bot

  Square-compress-left
    : Square ab (sym cd) (ae âˆ™ ef âˆ™ fd) bc
  Square-compress-left = tr (Î» p â†’ Square ab _ p bc) (âˆ™-assoc ae ef fd)
                           (coe (sym (Square-squeeze-botl fd)) Square-bl)
}
% ```
